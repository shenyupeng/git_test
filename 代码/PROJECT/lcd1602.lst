C51 COMPILER V9.00   LCD1602                                                               06/27/2015 09:46:00 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN ..\OBJ\lcd1602.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE ..\HARDWARE\LCD1602\lcd1602.c BROWSE INCDIR(..\HARDWARE\LCD12
                    -864;..\HARDWARE\TIMER;..\HARDWARE\TLC5615;..\PROJECT;..\USER;..\HARDWARE\LCD1602) DEBUG OBJECTEXTEND PRINT(.\lcd1602.lst
                    -) OBJECT(..\OBJ\lcd1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          #include "timer.h"
   3          
   4          
   5          
   6          /*
   7          *1602初始化
   8          *输入参数：无
   9          *输出参数：无
  10          */
  11          void LCD_Init(void)
  12          {
  13   1              LCD_Data = 0;
  14   1      
  15   1      
  16   1              
  17   1              //三次显示模式设置，不检测忙信号
  18   1              LCD_WriteCommand(0x38,0);
  19   1              Delayms(5);
  20   1              LCD_WriteCommand(0x38,0);
  21   1              Delayms(5);
  22   1              LCD_WriteCommand(0x38,0);
  23   1              Delayms(5);
  24   1      
  25   1              //显示模式设置，开始要求每次检测忙信号
  26   1              LCD_WriteCommand(0x38,1);
  27   1              //关闭显示
  28   1              LCD_WriteCommand(0x08,1);
  29   1              //显示清屏
  30   1              LCD_WriteCommand(0x01,1);
  31   1              //显示光标移动设置
  32   1              LCD_WriteCommand(0x06,1);
  33   1              //显示开及光标设置
  34   1              LCD_WriteCommand(0x0C,1);
  35   1      }
  36          
  37          /*
  38          *1602写指令
  39          *输入参数：要写入的指令
  40          *输出参数：无
  41          */
  42          void LCD_WriteCommand(u8 WCLCD,BuysC)
  43          {
  44   1              if(BuysC)
  45   1              {
  46   2                      //根据需要检测忙
  47   2                      LCD_ReadStatus();
  48   2              }
  49   1              LCD_Data = WCLCD;
  50   1              LCD_RS = 0;
  51   1              LCD_RW = 0;
  52   1              LCD_E = 0;
  53   1              LCD_E = 0;
C51 COMPILER V9.00   LCD1602                                                               06/27/2015 09:46:00 PAGE 2   

  54   1              LCD_E = 1;
  55   1      }
  56          
  57          u8 LCD_ReadData(void)
  58          {
  59   1              LCD_RS = 1;
  60   1              LCD_RW = 1;
  61   1              LCD_E = 0;
  62   1              LCD_E = 0;
  63   1              LCD_E = 1;
  64   1              return(LCD_Data);
  65   1      }
  66          
  67          
  68          
  69          /*
  70          *1602读状态
  71          ×输入参数：无
  72          *输出参数：1602返回的状态
  73          */
  74          u8 LCD_ReadStatus(void)
  75          {
  76   1              LCD_Data = 0xFF;
  77   1              LCD_RS = 0;
  78   1              LCD_RW = 1;
  79   1              LCD_E = 0;
  80   1              LCD_E = 0;
  81   1              LCD_E = 1;
  82   1      
  83   1              //检测忙信号
  84   1              while(LCD_Data & 0x80)
  85   1              {}
  86   1              return (LCD_Data);
  87   1      }
  88          
  89          
  90          /*
  91          *1602按指定位置显示一个字符
  92          *输入参数：X坐标 Y坐标 要显示的字符
  93          ×输出参数：无
  94          */
  95          void DisplayOneChar(u8 X, u8 Y, u8 DData)
  96          {
  97   1              //限制X不能大于15，Y不能大于1
  98   1              Y &= 0x01;
  99   1              X &= 0x0F;
 100   1      
 101   1              //当要显示第二行时地址码+0x40；
 102   1              if(Y)
 103   1              {
 104   2                      X |= 0x40;
 105   2              }
 106   1              //算出指令码
 107   1              X |= 0x80;
 108   1      
 109   1              //这里不检测忙信号，发送地址码
 110   1              LCD_WriteCommand(X,0);
 111   1              LCD_WriteData(DData);
 112   1      }
 113          
 114          
 115          /*
C51 COMPILER V9.00   LCD1602                                                               06/27/2015 09:46:00 PAGE 3   

 116          *1602写数据
 117          *输入参数：要写入的数据
 118          *输出参数：无
 119          */
 120          void LCD_WriteData(u8 WDLCD)
 121          {
 122   1              //检测忙
 123   1              LCD_ReadStatus();
 124   1              LCD_Data = WDLCD;
 125   1              LCD_RS = 1;
 126   1              LCD_RW = 0;
 127   1              LCD_E = 0;
 128   1              LCD_E = 0;
 129   1              LCD_E = 1;
 130   1      }
 131          
 132          /*
 133          *1602指定位置显示一串字符
 134          *输入参数：X坐标 Y坐标 要显示字符串的首地址
 135          */
 136          void DisplayListChar(u8 X, u8 Y, u8 *DData)
 137          {
 138   1              u8 ListLength = 0;
 139   1              //限制X不能大于15，Y不能大于1
 140   1              Y &= 0x01;
 141   1              X &= 0x0F;
 142   1      
 143   1              while(0x20 <= DData[ListLength])
 144   1              {
 145   2                      if(0x0F >= X)
 146   2                      {
 147   3                              //显示单个字符
 148   3                              DisplayOneChar(X,Y,DData[ListLength]);
 149   3                              ListLength++;
 150   3                              X++;
 151   3                      }
 152   2              }
 153   1      }
 154          
 155          /*
 156          *1602显示一串数字
 157          *
 158          */
 159          void DisplayNumber(u8 X, u8 Y, u32 number,u8 count)
 160          {
 161   1              u8 array[11];
 162   1              u8 i;
 163   1              array[count] = 0;
 164   1              for (i = count; i>0; i--)
 165   1              {
 166   2                      array[i-1] = number % 10 + '0';
 167   2                      number /= 10; 
 168   2              }
 169   1      
 170   1              for (i = 0; i < count - 1; i++)
 171   1              {
 172   2                      if(array[i] == '0')
 173   2                      {
 174   3                              array[i] = ' ';
 175   3                      }
 176   2                      else
 177   2                      {
C51 COMPILER V9.00   LCD1602                                                               06/27/2015 09:46:00 PAGE 4   

 178   3                              break;
 179   3                      }
 180   2              }
 181   1              DisplayListChar(X,Y,array);
 182   1      }
 183          
 184          
 185          //显示浮点数字
 186          void DisplayFloatNumber(u8 X, u8 Y, u32 number,u8 count)
 187          {
 188   1              u8 array[17];
 189   1              u8 i;
 190   1              array[count] = 0;
 191   1              number /= 10;
 192   1              for (i = count; i>0; i--)
 193   1              {
 194   2                      if(i==count - 2)
 195   2                      {
 196   3                              array[i-1] = '.';
 197   3                              i--;
 198   3                      }
 199   2                      array[i-1] = number % 10 + '0';
 200   2                      number /= 10; 
 201   2              }
 202   1      
 203   1              for (i = 0; i < count - 1; i++)
 204   1              {
 205   2                      if(array[i] == '0')
 206   2                      {
 207   3                              array[i] = ' ';
 208   3                      }
 209   2                      else
 210   2                      {
 211   3                              break;
 212   3                      }
 213   2              }
 214   1              DisplayListChar(X,Y,array);
 215   1      }
 216          
 217          
 218          /*
 219          *显示清屏
 220          */
 221          void LCD_Clear(void)
 222          {
 223   1              //显示清屏
 224   1              LCD_WriteCommand(0x01,1);
 225   1              //显示光标移动设置
 226   1              LCD_WriteCommand(0x06,1);
 227   1              //显示开及光标设置
 228   1              LCD_WriteCommand(0x0C,1);
 229   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    556    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      52
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.00   LCD1602                                                               06/27/2015 09:46:00 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
